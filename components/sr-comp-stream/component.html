<link rel="import" href="../../bower_components/polymer/polymer.html" />

<polymer-element name="sr-comp-stream" attributes="url">
    <script>
        Polymer({
            load: function() {
                this.eventSource = new EventSource(this.realUrl);

                this.eventSource.addEventListener('match', function(e) {
                    this.fire('match', JSON.parse(e.data));
                }.bind(this));

                this.eventSource.addEventListener('team', function(e) {
                    this.fire('team', JSON.parse(e.data));
                }.bind(this));

                this.eventSource.addEventListener('knockouts', function(e) {
                    this.fire('knockouts', JSON.parse(e.data));
                }.bind(this));

                this.eventSource.addEventListener('last-scored-match', function(e) {
                    this.fire('last-scored-match', JSON.parse(e.data));
                }.bind(this));

                this.eventSource.addEventListener('error',
                    this.fire.bind(this, 'error'));

                this.eventSource.addEventListener('open',
                    this.fire.bind(this, 'open'));
            },
            urlChanged: function() {
                this.realUrl = this.url.replace(/\{([^{}]*)\}/g,
                                                function (match, p1) {
                                                    return window.location[p1];
                                                });
                console.log('Stream URL is:', this.realUrl);
            }
        });
    </script>
</polymer-element>
